<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="prev" title="Next Steps with Python" href="../next-steps/next-steps-python.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>Refactoring Basics - Computing Essentials</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #fbf1c7;
  --color-code-foreground: black;
  --color-problematic: #cc241d;
  --color-foreground-primary: #282828;
  --color-foreground-secondary: #3c3836;
  --color-foreground-muted: #504945;
  --color-foreground-border: #665c54;
  --color-background-primary: #f9f5d7;
  --color-background-secondary: #fbf1c7;
  --color-background-hover: #d5c4a1;
  --color-background-hover--transparent: #d5c4a1;
  --color-background-border: #a89984;
  --color-background-item: #a89984;
  --color-announcement-background: #282828dd;
  --color-announcement-text: #fbf1c7;
  --color-brand-primary: #79740e;
  --color-brand-content: #458588;
  --color-highlight-on-target: #ebdbb2;
  --color-highlighted-background: #fabd2f;
  --color-guilabel-background: #b1628680;
  --color-guilabel-border: #b1628680;
  --color-admonition-title: #b16286;
  --color-topic-title: #282828;
  --color-admonition-title--caution: #d79921;
  --color-admonition-title--warning: #d65d0e;
  --color-admonition-title--danger: #cc241d;
  --color-admonition-title--attention: #d65d0e;
  --color-admonition-title--error: #cc241d;
  --color-admonition-title--hint: #689d6a;
  --color-admonition-title--tip: #689d6a;
  --color-admonition-title--important: #458588;
  --color-admonition-title--note: #689d6a;
  --color-admonition-title--seealso: #458588;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-problematic: #fb4934;
  --color-foreground-primary: #fbf1c7;
  --color-foreground-secondary: #ebdbb2;
  --color-foreground-muted: #d5c4a1;
  --color-foreground-border: #bdae93;
  --color-background-primary: #282828;
  --color-background-secondary: #1d2021;
  --color-background-hover: #3c3836;
  --color-background-hover--transparent: #3c3836;
  --color-background-border: #928374;
  --color-background-item: #928374;
  --color-announcement-background: #fbf1c7dd;
  --color-announcement-text: #282828;
  --color-brand-primary: #b8bb26;
  --color-brand-content: #83a598;
  --color-highlight-on-target: #1d2021;
  --color-highlighted-background: #d79921;
  --color-guilabel-background: #d3869b80;
  --color-guilabel-border: #d3869b80;
  --color-admonition-title: #d3869b80;
  --color-topic-title: #ebdbb2;
  --color-admonition-title--caution: #fabd2f;
  --color-admonition-title--warning: #fe8019;
  --color-admonition-title--danger: #fb4934;
  --color-admonition-title--attention: #fe8019;
  --color-admonition-title--error: #fb4934;
  --color-admonition-title--hint: #8ec07c;
  --color-admonition-title--tip: #8ec07c;
  --color-admonition-title--important: #83a598;
  --color-admonition-title--note: #8ec07c;
  --color-admonition-title--seealso: #83a598;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-problematic: #fb4934;
  --color-foreground-primary: #fbf1c7;
  --color-foreground-secondary: #ebdbb2;
  --color-foreground-muted: #d5c4a1;
  --color-foreground-border: #bdae93;
  --color-background-primary: #282828;
  --color-background-secondary: #1d2021;
  --color-background-hover: #3c3836;
  --color-background-hover--transparent: #3c3836;
  --color-background-border: #928374;
  --color-background-item: #928374;
  --color-announcement-background: #fbf1c7dd;
  --color-announcement-text: #282828;
  --color-brand-primary: #b8bb26;
  --color-brand-content: #83a598;
  --color-highlight-on-target: #1d2021;
  --color-highlighted-background: #d79921;
  --color-guilabel-background: #d3869b80;
  --color-guilabel-border: #d3869b80;
  --color-admonition-title: #d3869b80;
  --color-topic-title: #ebdbb2;
  --color-admonition-title--caution: #fabd2f;
  --color-admonition-title--warning: #fe8019;
  --color-admonition-title--danger: #fb4934;
  --color-admonition-title--attention: #fe8019;
  --color-admonition-title--error: #fb4934;
  --color-admonition-title--hint: #8ec07c;
  --color-admonition-title--tip: #8ec07c;
  --color-admonition-title--important: #83a598;
  --color-admonition-title--note: #8ec07c;
  --color-admonition-title--seealso: #83a598;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../docs/intro.html"><div class="brand">Computing Essentials</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../docs/intro.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Computing Essentials</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/getting-started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lessons</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../first-steps/first-steps-bash.html">First Steps with Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-steps/first-steps-git.html">First Steps with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-paper.html">Git for Academic Papers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-steps/first-steps-python.html">First Steps with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../next-steps/next-steps-python.html">Next Steps with Python</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Refactoring Basics</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="tex2jax_ignore mathjax_ignore section" id="refactoring-basics">
<h1>Refactoring Basics<a class="headerlink" href="#refactoring-basics" title="Permalink to this headline">#</a></h1>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>Next Steps with Python</p></li>
<li><p><a class="reference external" href="https://exercism.org/tracks/python/concepts">Exercism</a> Python track: <a class="reference external" href="https://exercism.org/tracks/python/concepts/classes">Classes</a></p></li>
</ul>
</div>
<div class="topic">
<p class="topic-title">Objectives</p>
<ul class="simple">
<li><p>Make use of tests to better prevent destructive edits in future revisions</p></li>
</ul>
</div>
<p>We will reorganize our directory to better handle more scripts and data. We’ll
further refine our <code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> script to work with our new changes.</p>
<div class="section" id="summary-of-revisions">
<h2>Summary of Revisions<a class="headerlink" href="#summary-of-revisions" title="Permalink to this headline">#</a></h2>
<p>If you haven’t made your own edits, an updated version of <code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> as
expanded upon from the previous lesson can be found <a class="reference external" href="https://github.com/davidcurie/Computing-Essentials/blob/main/lessons/next_steps/find_max_revised.py">here</a>.</p>
<p>The example script provided above is outlined by the following core logic:</p>
<ul class="simple">
<li><p>Specify files to search</p></li>
<li><p>Get all filenames into a list</p></li>
<li><p>Group that list by some identifier (i.e. by month)</p></li>
<li><p>Operate on that grouped list</p></li>
</ul>
<p>A stripped-down version of the script looks like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># LOGIC FOR GATHERING FILES</span>

<span class="k">def</span> <span class="nf">get_all_filenames</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>

<span class="k">def</span> <span class="nf">sort_filenames</span><span class="p">(</span><span class="n">list_of_filenames</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">project_YYYYMM</span><span class="p">):</span>

<span class="c1"># LOGIC FOR MANAGING DATA</span>

<span class="k">def</span> <span class="nf">import_files_into_dataframe</span><span class="p">(</span><span class="n">parsed_list</span><span class="p">):</span>

<span class="k">def</span> <span class="nf">get_max_values</span><span class="p">(</span><span class="n">list_of_dataframes</span><span class="p">):</span>

<span class="c1"># INTENDED SEQUENCE OF OPERATIONS</span>

<span class="n">files_to_search</span> <span class="o">=</span> <span class="s1">'*/*'</span>
<span class="n">files_as_list</span> <span class="o">=</span> <span class="n">get_all_filenames</span><span class="p">(</span><span class="n">files_to_search</span><span class="p">)</span>
<span class="n">grouped_files</span> <span class="o">=</span> <span class="n">sort_filenames</span><span class="p">(</span><span class="n">files_as_list</span><span class="p">)</span>
<span class="n">df_list</span> <span class="o">=</span> <span class="n">import_files_into_dataframe</span><span class="p">(</span><span class="n">grouped_files</span><span class="p">)</span>
<span class="n">df_max_vals</span> <span class="o">=</span> <span class="n">get_max_values</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'summary.csv'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">df_max_vals</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>These logic of these core functions is made extensible by other helper
functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_get_date_from</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Return (YYYY, MM, DD) from filename string"""</span>
    <span class="c1"># Assumes filename: YYYY-MM-DD_other_text</span>
    <span class="n">YYYYMMDD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'_'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">YYYY</span><span class="p">,</span> <span class="n">MM</span><span class="p">,</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">YYYYMMDD</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">YYYY</span><span class="p">,</span> <span class="n">MM</span><span class="p">,</span> <span class="n">DD</span>

<span class="k">def</span> <span class="nf">_project_YYYY</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Return YYYY from filename string"""</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">_get_date_from</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_project_YYYYMM</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">"""Return YYYY-MM string from filename string"""</span>
    <span class="k">return</span> <span class="s1">'-'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_date_from</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_project_YYYYMMDD</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">""" Return YYYY-MM-DD string from filename string"""</span>
    <span class="k">return</span> <span class="s1">'-'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_get_date_from</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_import_data</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that these helper functions are named with a leading underscore. This is
a convention to tell other programmers that these are meant to be called by
other functions in our script but not to be called directly by the end-user.</p>
<p>The purpose of the helper functions in this example is to make the core
functions easier to read.</p>
<p>In the updated script, the <code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> function makes use of a
<code class="docutils literal notranslate"><span class="pre">group_by()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">itertools</span></code> library, which is part of the standard
Python library. This saves us from having to define our own grouping mechanism,
but we need to start with a sorted list and specify how to group that list.
Rather than hard-coding the sorting criteria logic directly inside the
<code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> function, we can define a sorting key (sometimes also called
a <em>list projection</em>) that handles the logic.</p>
<p>The list projections used here are functions that return some sortable value
from a filename. A sortable value is either a number or a string, where strings
are sorted in alphanumeric order (0–9A–Za–z). In our case, we assume that the
string <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> appears in the beginning of the filename. We then find a way to
return some subset of that string. If we want to sort or group by <code class="docutils literal notranslate"><span class="pre">YYYY</span></code>, we
find a way to return just these characters. Since our initial task is to group
by month, we want to <code class="docutils literal notranslate"><span class="pre">YYYY-MM</span></code> string from the filename. The year is included
to avoid grouping months from different years together.</p>
<p>Updating the sorting algorithm is then as simple as updating the sorting key in
the <code class="docutils literal notranslate"><span class="pre">group_by()</span></code> function. We don’t want to have to edit the guts of the
<code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> function each time we want to update the logic used by
<code class="docutils literal notranslate"><span class="pre">group_by()</span></code> function inside, so we pass in a parameter to <code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code>
and let <code class="docutils literal notranslate"><span class="pre">group_by()</span></code> access the contents of that parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sort_filenames</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">MyValue</span><span class="p">):</span>
    <span class="c1"># group_by logic that makes use of the value of `key`</span>
</pre></div>
</div>
<p>This indicates that the default sorting key is <code class="docutils literal notranslate"><span class="pre">MyValue</span></code> unless otherwise
specified at runtime. Running <code class="docutils literal notranslate"><span class="pre">sort_filenames(filenames)</span></code> would automatically
make use of <code class="docutils literal notranslate"><span class="pre">MyValue</span></code>, but if you wanted to change this at runtime, you could
invoke <code class="docutils literal notranslate"><span class="pre">sort_filenames(filenames,</span> <span class="pre">key=MyOtherValue)</span></code>.</p>
<p>Having adjustable parameters grouped into the function call makes it much
easier to make future edits without having to investigate the
sometimes-complicated logic buried in functions.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Aim to generalize functions by allowing variables that you foresee will change
in specific cases to be encapsulated as an optional function parameter. Give
default parameter values to control the assumed behavior of the function.</p>
</div>
</div>
<div class="section" id="more-refactoring">
<h2>More Refactoring<a class="headerlink" href="#more-refactoring" title="Permalink to this headline">#</a></h2>
<p>We’ve made our script easier to inspect in the future by outsourcing the key logic
into functions, but we haven’t made our project easier to inspect as a whole.</p>
<div class="section" id="cleaning-the-directory">
<h3>Cleaning the Directory<a class="headerlink" href="#cleaning-the-directory" title="Permalink to this headline">#</a></h3>
<p>If you’ve been following along with the lessons so far, your <code class="docutils literal notranslate"><span class="pre">first-steps/</span></code>
directory might look something like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>first-steps/
    ├──high-temp/
    ├──room-temp/
    └──LICENSE
    └──README
    └──clean-data
    └──environment.yml
    └──find_max.py
    └──summary.csv
    └──to-clean.txt
</pre></div>
</div>
<p>Suppose we want to divide our project into a <code class="docutils literal notranslate"><span class="pre">data/</span></code> <code class="docutils literal notranslate"><span class="pre">results/</span></code> and <code class="docutils literal notranslate"><span class="pre">scripts/</span></code>
folder. These changes might break the way some of our scripts access files, so
we’ll commit our directory structure to log our housecleaning in Git.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>first-steps<span class="o">)</span> ~/Computing-Essentials/first-steps $ git add . <span class="o">&amp;&amp;</span> git commit -m <span class="s2">"Start of housecleaning"</span>
</pre></div>
</div>
<p>Create these folders and move files until you get a directory structure like
the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>first-steps/
    ├──data/
        └──high-temp/
        └──room-temp/
        └──to-clean.txt
    ├──results/
        └──summary.csv
    ├──scripts/
        └──clean-data
        └──find_max.py
    └──LICENSE
    └──README
    └──environment.yml
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">clean-data</span></code> and <code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> files need to be edited in the way they
search for data. When looking for all data files, we previously used a wildcard
search <code class="docutils literal notranslate"><span class="pre">*/*</span></code> meaning <em>all directories</em>/<em>all files</em> <strong>relative to the working
directory of where this script is executed</strong>. Relative to the new location of
the script, that path looks something like <code class="docutils literal notranslate"><span class="pre">../data/*/*</span></code>.</p>
<div class="topic">
<p class="topic-title">Task</p>
<p>Update the search criteria for <code class="docutils literal notranslate"><span class="pre">clean-data</span></code> and <code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> so that they may
be run from the <code class="docutils literal notranslate"><span class="pre">scripts/</span></code> directory. Check that these produce the expected
results, say, for <code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> and that the results are written to their new
location.</p>
</div>
<div class="topic">
<p class="topic-title">Task</p>
<p>Log the changes corresponding to the newly organized directory and the modified
script files in Git as a commit with a message such as “Reorganize directory
into folders”</p>
</div>
</div>
<div class="section" id="using-tests">
<h3>Using Tests<a class="headerlink" href="#using-tests" title="Permalink to this headline">#</a></h3>
<p>The file given at the beginning of the lesson is a functioning copy of a
script that meets the current objectives. Sometimes the objectives of our
script evolve in ways that aren’t obvious to predict when first defining
functions.</p>
<p>Unit tests allow for us to make iterative changes to our code while we
restructure its logic and check to see that it still meets the core
requirements that we set out with.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For a more lucid discussion on why unit tests are important and how to
implement them, see <a class="reference external" href="https://goodresearch.dev/testing.html">https://goodresearch.dev/testing.html</a>.</p>
</div>
<p>It’s good practice to have a set of tests for each script. We’ll make a
separate <code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder to house each test, and name our tests after the
script they are meant to inspect.</p>
<div class="topic">
<p class="topic-title">Task</p>
<p>A set of tests for the file linked at the beginning of the lesson can be found
in <a class="reference external" href="https://github.com/davidcurie/Computing-Essentials/blob/main/lessons/refactoring-basics/tests/">this directory</a>. Make your own <code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder and copy the
contents of the example directory into your <code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder.</p>
</div>
<p>The tests may be run from the main project directory with the following line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>first-steps<span class="o">)</span> ~/Computing-Essentials/first-steps $ python -m pytest tests/find_max_test.py
</pre></div>
</div>
<div class="topic">
<p class="topic-title">Task</p>
<p>Check to make sure that all of the tests pass. Then commit the contents of the
<code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder to your repository.</p>
</div>
<p>Notice that in the <code class="docutils literal notranslate"><span class="pre">find_max_test.py</span></code> file, each function starts with the word
<em>test</em> and describes the performed test. This makes it easier to inspect which
tests failed.</p>
<p>The tests are only as valuable as the insight you have when designing the
tests. Often when refactoring, you’ll make errors that cause tests to fail.
Make note of those errors and design a test to catch that error in the future.</p>
<p>Here are two test suggestions that might motivate further changes to our
<code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> script.</p>
<div class="topic">
<p class="topic-title">Task</p>
<p>Write a unit test that checks whether <code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> continutes to sort by
month when there are spaces in the filenames. Then implement changes to
<code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> so that filenames with spaces don’t break the workflow.</p>
</div>
<div class="topic">
<p class="topic-title">Task</p>
<p>Write a unit test that checks whether <code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> continutes to sort by
month when the YYYY-MM-DD substring is not the first part of the filename. Then
implement changes to <code class="docutils literal notranslate"><span class="pre">sort_filenames()</span></code> so that filenames with spaces don’t
break the workflow.</p>
</div>
<div class="important topic">
<p class="topic-title">Challenge</p>
<p>Rewrite the modified <code class="docutils literal notranslate"><span class="pre">find_max.py</span></code> script given in this lesson to use
<em>Classes</em>.</p>
</div>
</div>
</div>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lessons/refactoring-basics"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="../next-steps/next-steps-python.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Next Steps with Python</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022 David Curie
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Refactoring Basics</a><ul>
<li><a class="reference internal" href="#summary-of-revisions">Summary of Revisions</a></li>
<li><a class="reference internal" href="#more-refactoring">More Refactoring</a><ul>
<li><a class="reference internal" href="#cleaning-the-directory">Cleaning the Directory</a></li>
<li><a class="reference internal" href="#using-tests">Using Tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    </body>
</html>
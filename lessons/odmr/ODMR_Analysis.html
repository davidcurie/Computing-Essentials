<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>User Tweaks - Computing Essentials</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #fbf1c7;
  --color-code-foreground: black;
  --color-problematic: #cc241d;
  --color-foreground-primary: #282828;
  --color-foreground-secondary: #3c3836;
  --color-foreground-muted: #504945;
  --color-foreground-border: #665c54;
  --color-background-primary: #f9f5d7;
  --color-background-secondary: #fbf1c7;
  --color-background-hover: #d5c4a1;
  --color-background-hover--transparent: #d5c4a1;
  --color-background-border: #a89984;
  --color-background-item: #a89984;
  --color-announcement-background: #282828dd;
  --color-announcement-text: #fbf1c7;
  --color-brand-primary: #79740e;
  --color-brand-content: #458588;
  --color-highlight-on-target: #ebdbb2;
  --color-highlighted-background: #fabd2f;
  --color-guilabel-background: #b1628680;
  --color-guilabel-border: #b1628680;
  --color-admonition-title: #b16286;
  --color-topic-title: #282828;
  --color-admonition-title--caution: #d79921;
  --color-admonition-title--warning: #d65d0e;
  --color-admonition-title--danger: #cc241d;
  --color-admonition-title--attention: #d65d0e;
  --color-admonition-title--error: #cc241d;
  --color-admonition-title--hint: #689d6a;
  --color-admonition-title--tip: #689d6a;
  --color-admonition-title--important: #458588;
  --color-admonition-title--note: #689d6a;
  --color-admonition-title--seealso: #458588;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-problematic: #fb4934;
  --color-foreground-primary: #fbf1c7;
  --color-foreground-secondary: #ebdbb2;
  --color-foreground-muted: #d5c4a1;
  --color-foreground-border: #bdae93;
  --color-background-primary: #282828;
  --color-background-secondary: #1d2021;
  --color-background-hover: #3c3836;
  --color-background-hover--transparent: #3c3836;
  --color-background-border: #928374;
  --color-background-item: #928374;
  --color-announcement-background: #fbf1c7dd;
  --color-announcement-text: #282828;
  --color-brand-primary: #b8bb26;
  --color-brand-content: #83a598;
  --color-highlight-on-target: #1d2021;
  --color-highlighted-background: #d79921;
  --color-guilabel-background: #d3869b80;
  --color-guilabel-border: #d3869b80;
  --color-admonition-title: #d3869b80;
  --color-topic-title: #ebdbb2;
  --color-admonition-title--caution: #fabd2f;
  --color-admonition-title--warning: #fe8019;
  --color-admonition-title--danger: #fb4934;
  --color-admonition-title--attention: #fe8019;
  --color-admonition-title--error: #fb4934;
  --color-admonition-title--hint: #8ec07c;
  --color-admonition-title--tip: #8ec07c;
  --color-admonition-title--important: #83a598;
  --color-admonition-title--note: #8ec07c;
  --color-admonition-title--seealso: #83a598;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-problematic: #fb4934;
  --color-foreground-primary: #fbf1c7;
  --color-foreground-secondary: #ebdbb2;
  --color-foreground-muted: #d5c4a1;
  --color-foreground-border: #bdae93;
  --color-background-primary: #282828;
  --color-background-secondary: #1d2021;
  --color-background-hover: #3c3836;
  --color-background-hover--transparent: #3c3836;
  --color-background-border: #928374;
  --color-background-item: #928374;
  --color-announcement-background: #fbf1c7dd;
  --color-announcement-text: #282828;
  --color-brand-primary: #b8bb26;
  --color-brand-content: #83a598;
  --color-highlight-on-target: #1d2021;
  --color-highlighted-background: #d79921;
  --color-guilabel-background: #d3869b80;
  --color-guilabel-border: #d3869b80;
  --color-admonition-title: #d3869b80;
  --color-topic-title: #ebdbb2;
  --color-admonition-title--caution: #fabd2f;
  --color-admonition-title--warning: #fe8019;
  --color-admonition-title--danger: #fb4934;
  --color-admonition-title--attention: #fe8019;
  --color-admonition-title--error: #fb4934;
  --color-admonition-title--hint: #8ec07c;
  --color-admonition-title--tip: #8ec07c;
  --color-admonition-title--important: #83a598;
  --color-admonition-title--note: #8ec07c;
  --color-admonition-title--seealso: #83a598;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../docs/intro.html"><div class="brand">Computing Essentials</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../docs/intro.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Computing Essentials</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/getting-started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lessons</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../first-steps/first-steps-bash.html">First Steps with Bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-steps/first-steps-git.html">First Steps with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-paper.html">Git for Academic Papers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-steps/first-steps-python.html">First Steps with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../next-steps/next-steps-python.html">Next Steps with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refactoring-basics/refactoring-basics.html">Refactoring Basics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Practice Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="odmr.html">ODMR Analysis</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># File handling and sorting</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="c1"># Math and plotting</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">tck</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span><span class="p">,</span> <span class="n">savgol_filter</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>


<span class="c1"># http://emilygraceripka.com/blog/16</span>
<span class="c1"># Modified to include a vertical offset</span>
<span class="k">def</span> <span class="nf">_1lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amp1</span><span class="p">,</span> <span class="n">cen1</span><span class="p">,</span> <span class="n">wid1</span><span class="p">,</span> <span class="n">yoff</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">amp1</span><span class="o">*</span><span class="n">wid1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">cen1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">wid1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">yoff</span>

<span class="k">def</span> <span class="nf">_2lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amp1</span><span class="p">,</span> <span class="n">cen1</span><span class="p">,</span> <span class="n">wid1</span><span class="p">,</span> <span class="n">amp2</span><span class="p">,</span> <span class="n">cen2</span><span class="p">,</span> <span class="n">wid2</span><span class="p">,</span> <span class="n">yoff</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">amp1</span><span class="o">*</span><span class="n">wid1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">cen1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">wid1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span>\
            <span class="p">(</span><span class="n">amp2</span><span class="o">*</span><span class="n">wid2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">cen2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">wid2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span>\
            <span class="n">yoff</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 7&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">datetime</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># Math and plotting</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="ne">ModuleNotFoundError</span>: No module named 'pandas'
</pre></div>
</div>
</div>
</div>
<div class="section" id="user-tweaks">
<h1>User Tweaks<a class="headerlink" href="#user-tweaks" title="Permalink to this headline">#</a></h1>
<p>Select desired plot style for personal taste, but return to default white style for exporting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt.style.use('dark_background')</span>
<span class="c1"># plt.style.use('seaborn-white')</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">)</span> <span class="c1"># Reset to default; use for exported figures</span>
<span class="c1"># plt.style.use('science')</span>
<span class="c1"># plt.style.use('notebook')</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="quick-plot">
<h1>Quick Plot<a class="headerlink" href="#quick-plot" title="Permalink to this headline">#</a></h1>
<p>Use this for a quick and dirty plot of colleague’s ODMR data.</p>
<blockquote>
<div><p>In his original Dropbox link, all of the data from the relevant runs was copied into
a single spreadsheet as extra columns alongside original data. This mixed together the
raw data and analysis into a single <code class="docutils literal notranslate"><span class="pre">.xls</span></code> spreadsheet, which was then exported to
<code class="docutils literal notranslate"><span class="pre">.csv</span></code> for more compatible storage in Dropbox. The exporting eliminated the
equations built into the spreadsheet, but the relevant data to plot is still accessible
in the right-most 4 columns in the first acquisition of the similarly-named .csv files.</p>
</div></blockquote>
<div class="section" id="path-to-analysis-file-same-as-first-file-in-similarly-named-set-of-files">
<h2>Path to analysis file (same as first file in similarly-named set of files)<a class="headerlink" href="#path-to-analysis-file-same-as-first-file-in-similarly-named-set-of-files" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at folder that has all ODMR files; use those that have 50 ns delay</span>
<span class="c1"># files = glob('path/to/ODMR-directory/words*to*match')</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">'data/ODMR*50ns*.csv'</span><span class="p">)</span>
<span class="c1"># Sort by creation time and select the oldest file</span>
<span class="n">file</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">file</span>  <span class="c1"># ODMR_500KBurst_350uW_50nsdelay.csv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>'data/ODMR_500KBurst_350uW_50nsdelay.csv'
</pre></div>
</div>
</div>
</div>
<p>The file has 9 sets of 4 columns, separated by a few empty columns. The first set of
4 columns is the first ODMR acquisition:</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Microwave frequency (MHz)</p></th>
<th class="head"><p>Reference</p></th>
<th class="head"><p>Signal</p></th>
<th class="head"><p>Contrast = (sig - ref)/ref</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3200</p></td>
<td><p>9614</p></td>
<td><p>9561</p></td>
<td><p>0.005512794</p></td>
</tr>
</tbody>
</table></div>
<p>The second set of 4 columns is the ODMR acquisition from <code class="docutils literal notranslate"><span class="pre">same-filename---2.csv</span></code>.
There are 7 such files with exactly the same acquisition parameters, each corresponding
to intensity (APD counts) of the filterd PL signal for 500k microwave pulses. There is an
additional acquisition acquired with 1M microwave pulses with a modified filename to
represent the higher number of pulses but othewise collected with the same acquisition
settings. Because all of these files have identical acquisition parameters and were
measured sequentially, we can effectively integrate all counts from all files. This gives
us [(7 x 500k) + 1M = 4.5M] total microwave pulses over which we can integrate.
This is what the last set of 4 columns represents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>...</th>
<th>48</th>
<th>49</th>
<th>50</th>
<th>51</th>
<th>52</th>
<th>53</th>
<th>54</th>
<th>55</th>
<th>56</th>
<th>57</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>3200.0</td>
<td>9614.0</td>
<td>9561.0</td>
<td>0.005513</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3200.0</td>
<td>18114.0</td>
<td>17812.0</td>
<td>...</td>
<td>-0.017121</td>
<td>NaN</td>
<td>NaN</td>
<td>Final Integrated Result with 4.5 million integ...</td>
<td>NaN</td>
<td>NaN</td>
<td>3200.0</td>
<td>74830.0</td>
<td>74804.0</td>
<td>0.000347</td>
</tr>
<tr>
<th>1</th>
<td>3205.0</td>
<td>8740.0</td>
<td>8638.0</td>
<td>0.011670</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3205.0</td>
<td>20782.0</td>
<td>20646.0</td>
<td>...</td>
<td>-0.015015</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3205.0</td>
<td>245713.0</td>
<td>245596.0</td>
<td>0.000476</td>
</tr>
<tr>
<th>2</th>
<td>3210.0</td>
<td>10046.0</td>
<td>10008.0</td>
<td>0.003783</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3210.0</td>
<td>20185.0</td>
<td>20155.0</td>
<td>...</td>
<td>-0.026732</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3210.0</td>
<td>80953.0</td>
<td>81211.0</td>
<td>-0.003187</td>
</tr>
<tr>
<th>3</th>
<td>3215.0</td>
<td>9277.0</td>
<td>9350.0</td>
<td>-0.007869</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3215.0</td>
<td>20013.0</td>
<td>20178.0</td>
<td>...</td>
<td>-0.010855</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3215.0</td>
<td>82979.0</td>
<td>83879.0</td>
<td>-0.010846</td>
</tr>
<tr>
<th>4</th>
<td>3220.0</td>
<td>10898.0</td>
<td>10945.0</td>
<td>-0.004313</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3220.0</td>
<td>20018.0</td>
<td>20074.0</td>
<td>...</td>
<td>-0.001742</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3220.0</td>
<td>88323.0</td>
<td>88683.0</td>
<td>-0.004076</td>
</tr>
</tbody>
</table></div>
<p>5 rows × 58 columns</p>
</div></div></div>
</div>
<p>We don’t need all 58 columns. Let’s reimport only the last 4 columns and clean up empty rows that contain NaN.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">54</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">57</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Remove empty rows, present from comments in other columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Frequency'</span><span class="p">,</span> <span class="s1">'Reference'</span><span class="p">,</span> <span class="s1">'Signal'</span><span class="p">,</span> <span class="s1">'Contrast'</span><span class="p">]</span>

<span class="c1"># Colleague says his calculated contrast should be negative, but it is positive in this</span>
<span class="c1"># dataset. It is unclear if the Reference and Signal columns are identified correctly,</span>
<span class="c1"># but let's assume he labeled them correctly and simply mixed up the computed order of</span>
<span class="c1"># (sig - ref), which we can correct with an explicit sign change.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Contrast'</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Contrast'</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 103 entries, 0 to 102
Data columns (total 4 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Frequency  103 non-null    float64
 1   Reference  103 non-null    float64
 2   Signal     103 non-null    float64
 3   Contrast   103 non-null    float64
dtypes: float64(4)
memory usage: 4.0 KB
</pre></div>
</div>
</div>
</div>
<p>We’ll also want to fit this ODMR data to two Lorentzian peaks using <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code>.
The curve_fit module is explicitly imported at the beginning of this notebook, and two generic
Lorentzian equations are defined above to be passed into the curve_fit function below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define x and y valaues to be used in Lorentzian fits</span>
<span class="n">x_array</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Frequency'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_array</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Contrast'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Make initial guesses for fit; will be updated below</span>
<span class="n">amp1</span><span class="p">,</span> <span class="n">cen1</span><span class="p">,</span> <span class="n">wid1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3400</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">amp2</span><span class="p">,</span> <span class="n">cen2</span><span class="p">,</span> <span class="n">wid2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3500</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">yoff</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># Optimize curve fit and store parameters</span>
<span class="n">popt_2lorentz</span><span class="p">,</span> <span class="n">pcov_2lorentz</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">_2lorentzian</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="n">amp1</span><span class="p">,</span> <span class="n">cen1</span><span class="p">,</span> <span class="n">wid1</span><span class="p">,</span> <span class="n">amp2</span><span class="p">,</span> <span class="n">cen2</span><span class="p">,</span> <span class="n">wid2</span><span class="p">,</span> <span class="n">yoff</span><span class="p">])</span>
<span class="n">perr_2lorentz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov_2lorentz</span><span class="p">))</span>
<span class="n">pars_1</span> <span class="o">=</span> <span class="n">popt_2lorentz</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># amp1, cen1, wid1</span>
<span class="n">pars_2</span> <span class="o">=</span> <span class="n">popt_2lorentz</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># amp2, cen2, wid2</span>
<span class="n">pars_3</span> <span class="o">=</span> <span class="n">popt_2lorentz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># yoffset (need to have [-1:] instead of [-1], else error next line)</span>
<span class="n">lorentz_peak_1</span> <span class="o">=</span> <span class="n">_1lorentzian</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_1</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_3</span><span class="p">)</span>
<span class="n">lorentz_peak_2</span> <span class="o">=</span> <span class="n">_1lorentzian</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_2</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the data along with its accompanying fit. Display the fit parameters below in case they are needed elsewhere.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">)</span>  <span class="c1"># Contrast values per frequency</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">_2lorentzian</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="o">*</span><span class="n">popt_2lorentz</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C7"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Double Lorentz fit</span>
<span class="c1"># ax.plot(x_array, lorentz_peak_1)  # Explicit peak 1</span>
<span class="c1"># ax.plot(x_array, lorentz_peak_2)  # Explicit peak 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'ODMR for hBN'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Microwave frequency (MHz)'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Contrast'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">tck</span><span class="o">.</span><span class="n">PercentFormatter</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>


<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'----- Peak 1 ---------'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Amplitude: '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Center:    '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Width:     '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'V. Offset: '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'---------------------</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'----- Peak 2 ---------'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Amplitude: '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Center:    '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Width:     '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'V. Offset: '</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">pars_3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'---------------------'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ODMR_500KBurst_350uW_50nsdelay.csv 
</pre></div>
</div>
<img alt="../../_images/ODMR_Analysis_13_1.png" src="../../_images/ODMR_Analysis_13_1.png"/>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- Peak 1 ---------
Amplitude:  -0.035567
Center:     3416.5
Width:      59.17
V. Offset:  0.01011
---------------------

----- Peak 2 ---------
Amplitude:  -0.027695
Center:     3516.5
Width:      53.78
V. Offset:  0.01011
---------------------
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils"/>
<div class="tex2jax_ignore mathjax_ignore section" id="refined-analysis">
<h1>Refined Analysis<a class="headerlink" href="#refined-analysis" title="Permalink to this headline">#</a></h1>
<p>The pipeline above works for the file that our colleague provided, but the processing pipeline
can be generalized and extended in the event more raw ODMR data is provided.</p>
<div class="section" id="guidelines">
<h2>Guidelines<a class="headerlink" href="#guidelines" title="Permalink to this headline">#</a></h2>
<p>The user is expected to provide a list of files of ODMR spectra collected at the same
location and with identical power settings. The filenames can differ in number of microwave
bursts, but currently the number of integrations is not tracked in the dataframe. The ODMR
data is concatenated for all files in this list, so extending the integration is as simple
as adding another file to the list.</p>
<div class="section" id="data-requirements">
<h3>Data requirements<a class="headerlink" href="#data-requirements" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Files in list have identical structure [Frequency, Ref, Sig]</p></li>
<li><p>Frequency values in each file have an overlapping subset</p></li>
<li><p>Frequency values are between 0 and 65e3 (uint16)</p></li>
<li><p>APD counts from all accumulated runs do not total more than 4.2e9 (uint32) in either channel</p></li>
</ul>
</div>
<div class="section" id="usage">
<h3>Usage:<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Adjust the filename list to point to the directory where your ODMR files are located</p></li>
<li><p>If analysis is needed on only one file, pass in a list of one element.</p></li>
<li><p>Select appropriate filtering in <code class="docutils literal notranslate"><span class="pre">glob</span></code> to pick out a subset of files if desired</p></li>
<li><p>Adjust threshold and distance parameters for cleaning via scipy.signal.find_peaks</p></li>
<li><p>Run All Cells</p>
<ul>
<li><p>Inspect cleaning results, adjust threshold as necessary</p></li>
</ul>
</li>
<li><p>Grab figures as necessary for publication</p>
<ul>
<li><p>Adjust graph style with rcParams instead of in plot</p></li>
</ul>
</li>
</ul>
<div class="section" id="scripting-support">
<h4>Scripting Support<a class="headerlink" href="#scripting-support" title="Permalink to this headline">#</a></h4>
<blockquote>
<div><p>To be included</p>
</div></blockquote>
<p>Goal: call this function from the command line:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>% python ODMR_Analysis.py -f files.csv -o output.png
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">output.png</span></code> is the result of the total ODMR contrast as computed from all input files.
<code class="docutils literal notranslate"><span class="pre">files.csv</span></code> can be one file or multiple files and may come from standard input so that
it can be included in a pipeline</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>% ls files-to-match <span class="p">|</span> python ODMR_Analysis.py -o /path/to/output.png
</pre></div>
</div>
<p>Bonus: be able to adjust <code class="docutils literal notranslate"><span class="pre">threshold</span></code> and <code class="docutils literal notranslate"><span class="pre">distance</span></code> from command line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_ODMR_csv_to_df</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">"""Return dataframe of first 3 columns in csv file.</span>
<span class="sd">    </span>
<span class="sd">    Expected .csv contents: Frequency, Reference, Signal.</span>
<span class="sd">    Converts Frequency to the index of the dataframe.</span>
<span class="sd">    """</span>
    <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Frequency'</span><span class="p">,</span> <span class="s1">'Reference'</span><span class="p">,</span> <span class="s1">'Signal'</span><span class="p">]</span>
    <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'Frequency'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="s1">'Reference'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="s1">'Signal'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span>
                     <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                     <span class="n">names</span><span class="o">=</span><span class="n">colnames</span><span class="p">,</span>
                     <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtypes</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">find_peaks_and_valleys</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">"""Return index of peaks and valleys in an array.</span>
<span class="sd">    </span>
<span class="sd">    Suggested usage:</span>
<span class="sd">    &gt;&gt;&gt; highlights = find_peak_and_valleys(y)</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(x,y)  # View normal graph</span>
<span class="sd">    &gt;&gt;&gt; plt.scatter(x[highlights], y[highlights])  # Highlight sharp points</span>
<span class="sd">    """</span>
    <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">array</span><span class="p">,</span>
                              <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                              <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">array</span><span class="p">)),</span>
                              <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                             <span class="p">)</span>
    <span class="n">inv_array</span> <span class="o">=</span> <span class="n">array</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">valleys</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">inv_array</span><span class="p">,</span>
                                <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                                <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">inv_array</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">inv_array</span><span class="p">)),</span>
                                <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                               <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">peaks</span><span class="p">,</span> <span class="n">valleys</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">peaks_and_valleys_in_plot</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">"""Return x[idx], y[idx] where idx are peak and valley indices in y.</span>
<span class="sd">    </span>
<span class="sd">    Suggested useage:</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(x,y)  # View normal graph</span>
<span class="sd">    &gt;&gt;&gt; plt.scatter(*peaks_and_valleys_in_plot(x,y)) ## Highlight points</span>
<span class="sd">    """</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">find_peaks_and_valleys</span><span class="p">(</span><span class="n">y_array</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_array</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    
<span class="k">def</span> <span class="nf">peaks_in_plot</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">"""Return x[pk_idx], y[pk_idx] where pk_idx values are found in y.</span>
<span class="sd">    </span>
<span class="sd">    Converts result of find_peaks index for y to be in same units as x</span>
<span class="sd">    when trying to plot y(x) relationship.</span>
<span class="sd">    </span>
<span class="sd">    Sugested usage:</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(x,y) # View normal graph</span>
<span class="sd">    &gt;&gt;&gt; plt.scatter(*peaks_in_plot(x, y)) # Highlight peaks</span>
<span class="sd">    """</span>
    <span class="n">pk_idx</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y_array</span><span class="p">,</span>
                               <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_array</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_array</span><span class="p">)),</span>
                               <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                              <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_array</span><span class="p">[</span><span class="n">pk_idx</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_array</span><span class="p">[</span><span class="n">pk_idx</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">peaks_and_values</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">"""Return [index], [peak_value] arrays that correspond to peaks in input array.</span>
<span class="sd">    </span>
<span class="sd">    Peaks are defined by a maximum value according to input threshold. The higher</span>
<span class="sd">    the threshold, the larger the peak needs to be in order to register as a peak.</span>
<span class="sd">    </span>
<span class="sd">    Valleys can be found by passing in the negative version of an array and inverting</span>
<span class="sd">    the output of peak_value.</span>
<span class="sd">    """</span>
    <span class="n">pk_idx</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span>
                               <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_array</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_array</span><span class="p">)),</span>
                               <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                              <span class="p">)</span>
    <span class="k">return</span> <span class="n">pk_idx</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="s1">'peak_heights'</span><span class="p">]</span>
    
<span class="k">def</span> <span class="nf">remove_spikes</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="sd">"""Remove large spikes in data and replace them with the average of its neighbors."""</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">peaks</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
        <span class="c1"># I experimented with different settings, but found a narrow replacement worked</span>
        <span class="c1"># better for peaks near the beginning or end of the dataset. Keep threshold high</span>
        <span class="c1"># to prevent overzealous removal of noise.</span>
        <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]]))</span> <span class="c1"># This part can be altered as needed.</span>
    <span class="k">return</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">scale_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
    <span class="sd">"""Multiply all values in array by a common factor."""</span>
    <span class="n">new_array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">new_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="k">return</span> <span class="n">new_array</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gather all raw ODMR files and set directories</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s1">'data/ODMR*50ns*.csv'</span><span class="p">))</span>
<span class="n">dat_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Identify ODMR data folder</span>
<span class="c1"># The following path might need to be changed if this notebook is</span>
<span class="c1"># is converted to a script, housed in a different location</span>
<span class="n">fig_dir</span> <span class="o">=</span> <span class="s1">'figs'</span> 

<span class="nb">print</span><span class="p">(</span><span class="s1">'Data directory:  '</span><span class="p">,</span> <span class="n">dat_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Figure directory:'</span><span class="p">,</span> <span class="n">fig_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data directory:   data
Figure directory: figs
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>['data/ODMR_1MBurst_350uW_50nsdelay.csv',
 'data/ODMR_500KBurst_350uW_50nsdelay.csv',
 'data/ODMR_500kBurst_350uW_50nsdelay---2.csv',
 'data/ODMR_500kBurst_350uW_50nsdelay---3.csv',
 'data/ODMR_500kBurst_350uW_50nsdelay---4.csv',
 'data/ODMR_500kBurst_350uW_50nsdelay---5.csv',
 'data/ODMR_500kBurst_350uW_50nsdelay---6.csv',
 'data/ODMR_500kBurst_350uW_50nsdelay---7.csv']
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="inspect-raw-data">
<h2>Inspect Raw Data<a class="headerlink" href="#inspect-raw-data" title="Permalink to this headline">#</a></h2>
<p>Look at the Reference and Signal counts in each file to see if any unusual spikes occur
in either case. We don’t want these to skew our contrast. The below code detects spikes
in the data using <code class="docutils literal notranslate"><span class="pre">scipy.signal.find_peaks</span></code> and the user-defined parameters <code class="docutils literal notranslate"><span class="pre">threshold</span></code>
and <code class="docutils literal notranslate"><span class="pre">distance</span></code>.</p>
<p>Adjust the threshold and distance parameters below until you are satisfied with the
detection of <em>unusual</em> spikes. The Reference and Signal counts fluctuate a decent amount
even on a well-behaved run, so keep the threshold high so that you don’t inadvertently
cut out meaningful signal.</p>
<p>Ensure that the peaks are selected for both Reference <strong>and</strong> Signal at the same location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># User tweaks --</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># Keep large, filter out only BIG spikes</span>
<span class="n">distance</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SCALE_FACTOR</span> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># Convert x-axis on final ODMR graph (e.g. from MHz to GHz)</span>
<span class="n">print_title</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Whether to include figure title in output (F for publication, T for slidedeck)</span>
<span class="c1"># --------------</span>

<span class="c1"># Generate template dataframe for frequencies, empty everything else</span>
<span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  <span class="c1"># Strip off directory name</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_ODMR_csv_to_df</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Plot original counts, detected peaks, corrected counts</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'Reference'</span><span class="p">,</span> <span class="s1">'Signal'</span><span class="p">]]:</span>
        <span class="c1"># Original data</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'dotted'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="c1"># Detected peaks</span>
        <span class="n">pk_idx</span><span class="p">,</span> <span class="n">pk_vals</span> <span class="o">=</span> <span class="n">peaks_and_values</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">pk_idx</span><span class="p">],</span> <span class="n">pk_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
        <span class="c1"># Cleaned data</span>
        <span class="n">new_column</span> <span class="o">=</span> <span class="s1">'Cleaned_'</span> <span class="o">+</span> <span class="n">col</span>
        <span class="n">df</span><span class="p">[</span><span class="n">new_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">remove_spikes</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                       <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                       <span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span>
                                      <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">new_column</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">new_column</span><span class="p">)</span>
<span class="c1">#         ax.legend()</span>
    <span class="c1"># Plot formatting</span>
<span class="c1">#     plt.title(filename)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Microwave frequency (MHz)'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Counts'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># While we are iterating, add similar column names together into new df</span>
    <span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">total_df</span><span class="p">,</span><span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Copy columns to right</span>
    <span class="n">total_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Pick out only rows that overlap entirely</span>
    <span class="n">total_df</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># Sum all values with same column name</span>
    
<span class="c1"># Format total_df to match plot styles above;</span>
<span class="c1"># necessary b/c plot and scatter use different color cycles</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Reference"</span><span class="p">:</span> <span class="s2">"C0"</span><span class="p">,</span> <span class="s2">"Signal"</span><span class="p">:</span> <span class="s2">"C2"</span><span class="p">,</span> <span class="s2">"Cleaned_Reference"</span><span class="p">:</span> <span class="s2">"C1"</span><span class="p">,</span> <span class="s2">"Cleaned_Signal"</span><span class="p">:</span> <span class="s2">"C3"</span><span class="p">}</span>
<span class="n">linestyles</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Reference"</span><span class="p">:</span> <span class="s2">"dotted"</span><span class="p">,</span> <span class="s2">"Signal"</span><span class="p">:</span> <span class="s2">"dotted"</span><span class="p">,</span> <span class="s2">"Cleaned_Reference"</span><span class="p">:</span> <span class="s2">"solid"</span><span class="p">,</span> <span class="s2">"Cleaned_Signal"</span><span class="p">:</span> <span class="s2">"solid"</span><span class="p">}</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">total_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">total_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># Helps keep filesize small</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'Total </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Sum from all files'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Microwave frequency (MHz)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Counts'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ODMR_Analysis_18_0.png" src="../../_images/ODMR_Analysis_18_0.png"/>
<img alt="../../_images/ODMR_Analysis_18_1.png" src="../../_images/ODMR_Analysis_18_1.png"/>
<img alt="../../_images/ODMR_Analysis_18_2.png" src="../../_images/ODMR_Analysis_18_2.png"/>
<img alt="../../_images/ODMR_Analysis_18_3.png" src="../../_images/ODMR_Analysis_18_3.png"/>
<img alt="../../_images/ODMR_Analysis_18_4.png" src="../../_images/ODMR_Analysis_18_4.png"/>
<img alt="../../_images/ODMR_Analysis_18_5.png" src="../../_images/ODMR_Analysis_18_5.png"/>
<img alt="../../_images/ODMR_Analysis_18_6.png" src="../../_images/ODMR_Analysis_18_6.png"/>
<img alt="../../_images/ODMR_Analysis_18_7.png" src="../../_images/ODMR_Analysis_18_7.png"/>
<img alt="../../_images/ODMR_Analysis_18_8.png" src="../../_images/ODMR_Analysis_18_8.png"/>
</div>
</div>
</div>
<div class="section" id="generate-odmr-contrast-from-cleaned-aggregate-data">
<h2>Generate ODMR contrast from cleaned, aggregate data<a class="headerlink" href="#generate-odmr-contrast-from-cleaned-aggregate-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate contrast columns for original and cleaned data</span>
<span class="c1"># Contrast = (sig - ref) / ref</span>
<span class="n">total_df</span><span class="p">[</span><span class="s1">'Cleaned_Contrast'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_df</span><span class="p">[</span><span class="s1">'Cleaned_Signal'</span><span class="p">]</span> <span class="o">-</span> <span class="n">total_df</span><span class="p">[</span><span class="s1">'Cleaned_Reference'</span><span class="p">])</span> <span class="o">/</span> <span class="n">total_df</span><span class="p">[</span><span class="s1">'Cleaned_Reference'</span><span class="p">]</span>
<span class="n">total_df</span><span class="p">[</span><span class="s1">'Contrast'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_df</span><span class="p">[</span><span class="s1">'Signal'</span><span class="p">]</span> <span class="o">-</span> <span class="n">total_df</span><span class="p">[</span><span class="s1">'Reference'</span><span class="p">])</span> <span class="o">/</span> <span class="n">total_df</span><span class="p">[</span><span class="s1">'Reference'</span><span class="p">]</span>

<span class="c1"># Generate fits</span>
<span class="c1"># Define x and y valaues to be used in Lorentzian fits</span>
<span class="n">x_array</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_array</span> <span class="o">=</span> <span class="n">total_df</span><span class="p">[</span><span class="s1">'Cleaned_Contrast'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Make initial guesses for fit; will be updated below</span>
<span class="n">pars_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3400</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># amp, cen, wid</span>
<span class="n">pars_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3500</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># amp, cen, wid</span>
<span class="n">yoff</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># same for both peaks</span>

<span class="c1"># Rescale Frequency and fitting data</span>
<span class="n">x_array</span> <span class="o">=</span> <span class="n">scale_array</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">SCALE_FACTOR</span><span class="p">)</span>
<span class="n">pars_1</span> <span class="o">=</span> <span class="n">scale_array</span><span class="p">(</span><span class="n">pars_1</span><span class="p">,</span> <span class="n">SCALE_FACTOR</span><span class="p">)</span>
<span class="n">pars_2</span> <span class="o">=</span> <span class="n">scale_array</span><span class="p">(</span><span class="n">pars_2</span><span class="p">,</span> <span class="n">SCALE_FACTOR</span><span class="p">)</span>
<span class="c1"># TODO: Find a way to nest this in a loop</span>
<span class="c1"># Tried, but does not work:</span>
<span class="c1">#   [scale_array(each, SCALE_FACTOR) for each in (x_array, pars_1, pars_2)]</span>

<span class="c1"># Optimize curve fit and store parameters</span>
<span class="n">popt_2lorentz</span><span class="p">,</span> <span class="n">pcov_2lorentz</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">_2lorentzian</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">pars_1</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_2</span><span class="p">,</span> <span class="n">yoff</span><span class="p">])</span>
<span class="n">perr_2lorentz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov_2lorentz</span><span class="p">))</span>
<span class="n">pars_1</span> <span class="o">=</span> <span class="n">popt_2lorentz</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># amp1, cen1, wid1</span>
<span class="n">pars_2</span> <span class="o">=</span> <span class="n">popt_2lorentz</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># amp2, cen2, wid2</span>
<span class="n">pars_3</span> <span class="o">=</span> <span class="n">popt_2lorentz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># yoffset</span>
<span class="n">lorentz_peak_1</span> <span class="o">=</span> <span class="n">_1lorentzian</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_1</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_3</span><span class="p">)</span>
<span class="n">lorentz_peak_2</span> <span class="o">=</span> <span class="n">_1lorentzian</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_2</span><span class="p">,</span> <span class="o">*</span><span class="n">pars_3</span><span class="p">)</span>

<span class="c1"># Display results</span>
<span class="c1"># fig, ax = plt.subplots()</span>
<span class="c1"># fig, ax = plt.subplots(figsize=(2.5,2.5)) # Original</span>
<span class="c1"># fig, ax = plt.subplots(figsize=(2.5,1.33)) # TOC subset</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.6</span><span class="p">,</span><span class="mf">2.5</span><span class="p">))</span> <span class="c1"># wide</span>
<span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># ax = fig.add_subplot(1,1,1)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># Contrast values per frequency</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="n">_2lorentzian</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span> <span class="o">*</span><span class="n">popt_2lorentz</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">"C5"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Double Lorentz fit</span>
<span class="c1"># ax.scatter(x_array, y_array, s=4)  # Contrast values per frequency</span>
<span class="c1"># ax.plot(x_array, _2lorentzian(x_array, *popt_2lorentz), c="C5")  # Double Lorentz fit</span>
<span class="c1"># ax.plot(x_array, lorentz_peak_1)  # Explicit peak 1</span>
<span class="c1"># ax.plot(x_array, lorentz_peak_2)  # Explicit peak 2</span>
<span class="k">if</span> <span class="n">print_title</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'ODMR for hBN'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Microwave frequency (GHz)'</span><span class="p">)</span> <span class="c1"># TODO: Update label based on SCALE_FACTOR</span>
<span class="c1"># ax.set_ylim(None,2.5e-2)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'$\Delta \mathrm</span><span class="si">{PL}</span><span class="s1">/ \mathrm</span><span class="si">{PL}</span><span class="s1">$'</span><span class="p">)</span>
<span class="c1"># ax.ticklabel_format(style='sci', scilimits=(-1,0))</span>
<span class="c1"># ax.yaxis.tick_right()</span>
<span class="c1"># ax.yaxis.set_major_formatter(tck.PercentFormatter(1.0))</span>
<span class="c1"># plt.legend()</span>

<span class="n">fig_name</span> <span class="o">=</span> <span class="s1">'ODMR_contrast'</span>
<span class="n">fig_ext</span> <span class="o">=</span> <span class="s1">'png'</span>
<span class="n">fig_path</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">fig_dir</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="n">fig_name</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">,</span> <span class="n">fig_ext</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_ext</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'File saved to </span><span class="si">{</span><span class="n">fig_path</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="n">integrations</span> <span class="o">=</span> <span class="mf">4.5e6</span>  <span class="c1"># TODO: Find out a way to determine this from files</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Integrations: '</span><span class="p">,</span> <span class="s1">'</span><span class="si">{:.2e}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">integrations</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Amplitude'</span><span class="p">,</span> <span class="s1">'Center'</span><span class="p">,</span> <span class="s1">'Width'</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pars_1</span><span class="p">,</span> <span class="n">pars_2</span><span class="p">]</span>
<span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="s1">'Peak 1'</span><span class="p">,</span> <span class="s1">'Peak 2'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">header</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File saved to figs/ODMR_contrast.png
Integrations:  4.50e+06
</pre></div>
</div>
<img alt="../../_images/ODMR_Analysis_20_1.png" src="../../_images/ODMR_Analysis_20_1.png"/>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        Amplitude    Center     Width
Peak 1  -0.035567  3.416506 -0.059199
Peak 2  -0.027707  3.516549  0.053874
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="todo-items">
<h1>TODO Items<a class="headerlink" href="#todo-items" title="Permalink to this headline">#</a></h1>
<ol>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Let user specify whether title should appear in figure.</p>
<ul class="simple">
<li><p>Titles are useful when presenting figures in meetings.</p></li>
<li><p>Titles are sometimes superfluous in compound figures, where the graph will be identified in the caption.</p></li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Specify a global scaling factor to display data.</p>
<ul class="simple">
<li><p>Data should remain in SI units (i.e. Frequency in Hz, not GHz).</p></li>
<li><p>Graph axes labels should update with scale.</p>
<ul>
<li><p>Ideally, this should only affect plot, but not underlying dataframe.</p></li>
<li><p>Fits and analysis also need to scale with this factor.</p></li>
<li><p>For now, only needs to apply to x-axis values (Frequency).</p></li>
</ul>
</li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Add quality checks to prevent user from inputing wrong data files (wrong fname_str)</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Raise error if data files don’t have 3 columns</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Raise error if frequency counts are negative</p></li>
<li><p>Aim to raise errors for input that will “work” but won’t give desired results</p>
<ul>
<li><p>Program already fails loudly on incompatible dtypes; make it fail if compatible but nonsensical</p></li>
</ul>
</li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Make unit tests</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Test whether SCALE_FACTOR can be 1e-9, … , 1e9</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Test that neg freq values and neg counts don’t crash</p>
<ul>
<li><p>User can see from plot that data doesn’t make sense</p></li>
</ul>
</li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Refactor notebook.</p>
<ul class="contains-task-list">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Move all definitions into a logically-grouped module.</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Group together user-modifiable parameters and let these be inputs</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Make these optional inputs, and specify sensible defaults</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Let graphs be controlled by rcParams instead of hard coding figsize, line, color, etc</p>
<ul>
<li><p>User can call own style file to control all plots at once</p></li>
<li><p>Figure out how to specify relative large/small figures w/in rcParam settings</p></li>
</ul>
</li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Main function should be to generate ODMR plot from input files.</p>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Also make function to inspect all data files (shows before/after cleaning)</p></li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Make the analysis scriptable from command line.</p>
<ul class="simple">
<li><p>Example usage:</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>% python ODMR_Analysis.py -f data_file1.csv data_file2.csv -o path/to/output.png
</pre></div>
</div>
</li>
</ul>
</li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> Call the contents of this notebook from a single notebook responsible for generating all figures in paper.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sharable_final_notebook.ipynb</span>
<span class="kn">from</span> <span class="nn">ODMR_Analysis</span> <span class="kn">import</span> <span class="n">plot_ODMR</span>
<span class="kn">from</span> <span class="nn">other_module</span> <span class="kn">import</span> <span class="n">other_plot</span>

<span class="n">ODMR_data_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'dat_dir'</span><span class="p">:</span> <span class="n">dat_path</span><span class="p">,</span>
                    <span class="s1">'fig_dir'</span><span class="p">:</span> <span class="n">fig_path</span><span class="p">,</span>
                    <span class="s1">'files_to_select'</span><span class="p">:</span> <span class="n">fname_str</span><span class="p">,</span>
                    <span class="s1">'print_title'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="c1"># other user-tweaks</span>
                   <span class="p">}</span>
<span class="n">plot_ODMR</span><span class="p">(</span><span class="o">*</span><span class="n">ODMR_data_params</span><span class="p">)</span>  <span class="c1"># Display results in notebook, update fig in fig_dir</span>

<span class="n">other_plot</span><span class="p">(</span><span class="o">*</span><span class="n">other_params</span><span class="p">)</span> <span class="c1"># Display other results in same notebook</span>
</pre></div>
</div>
</li>
</ol>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lessons/odmr"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022 David Curie
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">User Tweaks</a></li>
<li><a class="reference internal" href="#quick-plot">Quick Plot</a><ul>
<li><a class="reference internal" href="#path-to-analysis-file-same-as-first-file-in-similarly-named-set-of-files">Path to analysis file (same as first file in similarly-named set of files)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#refined-analysis">Refined Analysis</a><ul>
<li><a class="reference internal" href="#guidelines">Guidelines</a><ul>
<li><a class="reference internal" href="#data-requirements">Data requirements</a></li>
<li><a class="reference internal" href="#usage">Usage:</a><ul>
<li><a class="reference internal" href="#scripting-support">Scripting Support</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#inspect-raw-data">Inspect Raw Data</a></li>
<li><a class="reference internal" href="#generate-odmr-contrast-from-cleaned-aggregate-data">Generate ODMR contrast from cleaned, aggregate data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#todo-items">TODO Items</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    </body>
</html>